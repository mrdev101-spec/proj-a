<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Health Station</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    <script>
        // Prevent white flash on load
        if (localStorage.getItem('darkMode') === 'enabled' || (!('darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        /* Immediate Dark Mode Support */
        html.dark body {
            background-color: #0f172a !important;
            color: #e2e8f0 !important;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .dark .glass-effect {
            background: rgba(30, 41, 59, 0.9);
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 font-sans transition-colors duration-300">

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="glass-effect shadow-sm border-b border-slate-200/50 dark:border-slate-700/50 sticky top-0 z-10">
            <div class="max-w-3xl mx-auto px-6 h-16 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="javascript:history.back()"
                        class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors text-slate-600 dark:text-slate-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </a>
                    <h1 class="text-xl font-bold text-slate-800 dark:text-white" data-i18n="nav_settings">Settings</h1>
                </div>
            </div>
        </header>

        <!-- Content -->
        <main class="flex-1 w-full max-w-3xl mx-auto px-6 py-8 space-y-6">

            <!-- Settings List -->
            <div
                class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
                <div class="space-y-4">
                    <!-- Theme Toggle -->
                    <div class="flex items-center justify-between p-4 rounded-xl bg-slate-50 dark:bg-slate-700/50">
                        <div>
                            <h3 class="font-medium text-slate-800 dark:text-white" data-i18n="settings_theme">Theme</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400" data-i18n="settings_theme_desc">Toggle
                                between Light and Dark mode</p>
                        </div>
                        <button id="theme-toggle"
                            class="p-2 rounded-lg bg-white dark:bg-slate-600 shadow-sm border border-slate-200 dark:border-slate-500 text-slate-600 dark:text-slate-200">
                            <svg class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                            </svg>
                            <svg class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Language Toggle -->
                    <div class="flex items-center justify-between p-4 rounded-xl bg-slate-50 dark:bg-slate-700/50">
                        <div>
                            <h3 class="font-medium text-slate-800 dark:text-white" data-i18n="settings_language">
                                Language</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400" data-i18n="settings_language_desc">
                                Select your preferred language</p>
                        </div>
                        <div
                            class="flex bg-white dark:bg-slate-600 rounded-lg p-1 border border-slate-200 dark:border-slate-500">
                            <button onclick="setLanguage('th')" id="lang-th"
                                class="px-3 py-1.5 rounded-md text-xs font-bold transition-all duration-200">TH</button>
                            <button onclick="setLanguage('en')" id="lang-en"
                                class="px-3 py-1.5 rounded-md text-xs font-bold transition-all duration-200">EN</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex justify-end mt-6">
                <button id="save-btn" onclick="saveSettings()" disabled
                    class="bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:dark:bg-slate-700 disabled:cursor-not-allowed text-white font-bold py-3 px-8 rounded-xl shadow-lg flex items-center gap-2 transition-all hover:scale-105 disabled:hover:scale-100 disabled:shadow-none">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span data-i18n="btn_save">Save Changes</span>
                </button>
            </div>

        </main>
    </div>

    <script src="common.js?v=9"></script>
    <script src="components.js?v=12"></script>
    <script>
        const translations = {
            en: {
                nav_settings: 'Settings',
                settings_theme: 'Theme',
                settings_theme_desc: 'Toggle between Light and Dark mode',
                settings_language: 'Language',
                settings_language_desc: 'Select your preferred language',
                btn_save: 'Save Changes'
            },
            th: {
                nav_settings: 'การตั้งค่า',
                settings_theme: 'ธีม',
                settings_theme_desc: 'สลับระหว่างโหมดสว่างและมืด',
                settings_language: 'ภาษา',
                settings_language_desc: 'เลือกภาษาที่คุณต้องการ',
                btn_save: 'บันทึกการเปลี่ยนแปลง'
            }
        };

        // Local state for preview
        let originalLang = localStorage.getItem('language') || 'th';
        let originalTheme = localStorage.getItem('darkMode') === 'enabled' ? 'dark' : 'light';

        let pendingLang = originalLang;
        let pendingTheme = originalTheme;

        function checkChanges() {
            const hasChanges = (pendingLang !== originalLang) || (pendingTheme !== originalTheme);
            const btn = document.getElementById('save-btn');
            if (hasChanges) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }

        // Override setLanguage for Preview
        window.previewLanguage = function (lang) {
            if (lang !== pendingLang) {
                pendingLang = lang;

                // Update UI Preview
                updateLanguageButtons(lang);

                // Update Text Preview (We need to temporarily switch global currentLang for updateUIText to work)
                const tempLang = currentLang;
                currentLang = lang;
                updateUIText();
                currentLang = tempLang;

                checkChanges();
            }
        };

        // Override toggleTheme for Preview
        window.previewTheme = function () {
            const newTheme = pendingTheme === 'dark' ? 'light' : 'dark';
            pendingTheme = newTheme;

            // Update UI Preview
            if (pendingTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            updateThemeToggleUI();

            checkChanges();
        };

        window.saveSettings = function () {
            // Commit changes
            localStorage.setItem('language', pendingLang);
            localStorage.setItem('darkMode', pendingTheme === 'dark' ? 'enabled' : 'disabled');

            // Update globals
            currentLang = pendingLang;
            originalLang = pendingLang;
            originalTheme = pendingTheme;

            // Update UI
            checkChanges();

            // Show Success
            showThemeAlert({
                icon: 'success',
                title: pendingLang === 'th' ? 'บันทึกสำเร็จ' : 'Saved Successfully',
                showConfirmButton: false,
                timer: 1500
            }).then(() => {
                // Reload to apply changes system-wide
                window.location.reload();
            });
        };

        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initTheme();
            initLanguage();

            // Attach Preview Listeners
            document.getElementById('lang-th').onclick = () => previewLanguage('th');
            document.getElementById('lang-en').onclick = () => previewLanguage('en');
            document.getElementById('theme-toggle').onclick = previewTheme;

            // Initialize state
            originalLang = currentLang;
            originalTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            pendingLang = originalLang;
            pendingTheme = originalTheme;

            // Initial check
            checkChanges();
        });
    </script>
</body>

</html>